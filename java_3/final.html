<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <title>CONGRATS</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">
</head>

<body>
  <script type="text/javascript" src="/assets/js/rhill-voronoi-core.js"></script>
  <div class="paperscript">
    <div class="buttons">
      <div class="button run" style="margin-right: 8px;">Source</div>
      <div class="explain hidden">To run it again, simply press press <b>Run</b> â†’</div>
    </div>
    <div class="source hidden" style="border-width: 0px 0px 0px 1px; width: 1055px; height: 633px;">
      <div class="CodeMirror">
        <div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 1990px; left: 204px;"><textarea wrap="off" autocorrect="off" autocapitalize="off" style="position: absolute; padding: 0px; width: 1px; height: 1em;"></textarea>
        </div>
        <div class="CodeMirror-scrollbar" style="z-index: -2; visibility: hidden; display: none;">
          <div class="CodeMirror-scrollbar-inner"></div>
        </div>
        <div class="CodeMirror-scroll cm-s-default" tabindex="-1" draggable="false">
          <div style="position: relative;">
            <div style="position: relative; top: 0px;">
              <div class="CodeMirror-gutter" style="height: 2162px;">
                <div class="CodeMirror-gutter-text">
                  <pre>1</pre>
                  <pre>2</pre>
                  <pre>3</pre>
                  <pre>4</pre>
                  <pre>5</pre>
                  <pre>6</pre>
                  <pre>7</pre>
                  <pre>8</pre>
                  <pre>9</pre>
                  <pre>10</pre>
                  <pre>11</pre>
                  <pre>12</pre>
                  <pre>13</pre>
                  <pre>14</pre>
                  <pre>15</pre>
                  <pre>16</pre>
                  <pre>17</pre>
                  <pre>18</pre>
                  <pre>19</pre>
                  <pre>20</pre>
                  <pre>21</pre>
                  <pre>22</pre>
                  <pre>23</pre>
                  <pre>24</pre>
                  <pre>25</pre>
                  <pre>26</pre>
                  <pre>27</pre>
                  <pre>28</pre>
                  <pre>29</pre>
                  <pre>30</pre>
                  <pre>31</pre>
                  <pre>32</pre>
                  <pre>33</pre>
                  <pre>34</pre>
                  <pre>35</pre>
                  <pre>36</pre>
                  <pre>37</pre>
                  <pre>38</pre>
                  <pre>39</pre>
                  <pre>40</pre>
                  <pre>41</pre>
                  <pre>42</pre>
                  <pre>43</pre>
                  <pre>44</pre>
                  <pre>45</pre>
                  <pre>46</pre>
                  <pre>47</pre>
                  <pre>48</pre>
                  <pre>49</pre>
                  <pre>50</pre>
                  <pre>51</pre>
                  <pre>52</pre>
                  <pre>53</pre>
                  <pre>54</pre>
                  <pre>55</pre>
                  <pre>56</pre>
                  <pre>57</pre>
                  <pre>58</pre>
                  <pre>59</pre>
                  <pre>60</pre>
                  <pre>61</pre>
                  <pre>62</pre>
                  <pre>63</pre>
                  <pre>64</pre>
                  <pre>65</pre>
                  <pre>66</pre>
                  <pre>67</pre>
                  <pre>68</pre>
                  <pre>69</pre>
                  <pre>70</pre>
                  <pre>71</pre>
                  <pre>72</pre>
                  <pre>73</pre>
                  <pre>74</pre>
                  <pre>75</pre>
                  <pre>76</pre>
                  <pre>77</pre>
                  <pre>78</pre>
                  <pre>79</pre>
                  <pre>80</pre>
                  <pre>81</pre>
                  <pre>82</pre>
                  <pre>83</pre>
                  <pre>84</pre>
                  <pre>85</pre>
                  <pre>86</pre>
                  <pre>87</pre>
                  <pre>88</pre>
                  <pre>89</pre>
                  <pre>90</pre>
                  <pre>91</pre>
                  <pre>92</pre>
                  <pre>93</pre>
                  <pre>94</pre>
                  <pre>95</pre>
                  <pre>96</pre>
                  <pre>97</pre>
                  <pre>98</pre>
                  <pre>99</pre>
                  <pre>100</pre>
                  <pre>101</pre>
                  <pre>102</pre>
                  <pre>103</pre>
                  <pre>104</pre>
                  <pre>105</pre>
                  <pre>106</pre>
                  <pre>107</pre>
                  <pre>108</pre>
                  <pre>109</pre>
                  <pre>110</pre>
                  <pre>111</pre>
                  <pre>112</pre>
                  <pre>113</pre>
                  <pre>114</pre>
                  <pre>115</pre>
                  <pre>116</pre>
                  <pre>117</pre>
                  <pre>118</pre>
                  <pre>119</pre>
                </div>
              </div>
              <div class="CodeMirror-lines">
                <div style="position: relative; z-index: 0; outline: none; min-width: 635px; margin-left: 35px;">
                  <div style="position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden;">
                    <pre><span class="cm-tab">    </span><span class="cm-variable">renderDiagram</span>();<span> </span></pre>
                  </div>
                  <pre class="CodeMirror-cursor" style="top: 1980px; left: 161px;">&nbsp;</pre>
                  <pre class="CodeMirror-cursor" style="visibility: hidden; left: 626px;">&nbsp;</pre>
                  <div style="position: relative; z-index: -1; display: none;">
                    <div class="CodeMirror-selected" style="position: absolute; left: 0px; top: 0px; right: -1px; height: 2124px;"></div>
                    <div class="CodeMirror-selected" style="position: absolute; left: 0px; top: 2124px; right: 1003px; height: 18px;"></div>
                  </div>
                  <div style="">
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">voronoi</span> =  <span class="cm-keyword">new</span> <span class="cm-variable">Voronoi</span>();</pre>
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">sites</span> = <span class="cm-variable">generateBeeHivePoints</span>(<span class="cm-variable">view</span>.<span class="cm-property">size</span> / <span class="cm-number">200</span>, <span class="cm-atom">true</span>);</pre>
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">bbox</span>, <span class="cm-variable">diagram</span>;</pre>
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">oldSize</span> = <span class="cm-variable">view</span>.<span class="cm-property">size</span>;</pre>
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">spotColor</span> = <span class="cm-keyword">new</span> <span class="cm-variable">Color</span>(<span class="cm-string">'red'</span>);</pre>
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">mousePos</span> = <span class="cm-variable">view</span>.<span class="cm-property">center</span>;</pre>
                    <pre><span class="cm-keyword">var</span> <span class="cm-variable">selected</span> = <span class="cm-atom">false</span>;</pre>
                    <pre> </pre>
                    <pre><span class="cm-variable">onResize</span>();</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">onMouseDown</span>(<span class="cm-def">event</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">sites</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">event</span>.<span class="cm-property">point</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">renderDiagram</span>();</pre>
                    <pre>}</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">onMouseMove</span>(<span class="cm-def">event</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">mousePos</span> = <span class="cm-variable-2">event</span>.<span class="cm-property">point</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">if</span> (<span class="cm-variable-2">event</span>.<span class="cm-property">count</span> == <span class="cm-number">0</span>)</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">sites</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">event</span>.<span class="cm-property">point</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">sites</span>[<span class="cm-variable">sites</span>.<span class="cm-property">length</span> - <span class="cm-number">1</span>] = <span class="cm-variable-2">event</span>.<span class="cm-property">point</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">renderDiagram</span>();</pre>
                    <pre>}</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">renderDiagram</span>() {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">project</span>.<span class="cm-property">activeLayer</span>.<span class="cm-property">children</span> = [];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">diagram</span> = <span class="cm-variable">voronoi</span>.<span class="cm-property">compute</span>(<span class="cm-variable">sites</span>, <span class="cm-variable">bbox</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">if</span> (<span class="cm-variable-2">diagram</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> = <span class="cm-number">0</span>, <span class="cm-def">l</span> = <span class="cm-variable">sites</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span> &lt; <span class="cm-variable-2">l</span>; <span class="cm-variable-2">i</span>++) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">cell</span> = <span class="cm-variable-2">diagram</span>.<span class="cm-property">cells</span>[<span class="cm-variable">sites</span>[<span class="cm-variable-2">i</span>].<span class="cm-property">voronoiId</span>];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span> (<span class="cm-variable-2">cell</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">halfedges</span> = <span class="cm-variable-2">cell</span>.<span class="cm-property">halfedges</span>,</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-def">length</span> = <span class="cm-variable-2">halfedges</span>.<span class="cm-property">length</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span> (<span class="cm-variable-2">length</span> &gt; <span class="cm-number">2</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">points</span> = [];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">j</span> = <span class="cm-number">0</span>; <span class="cm-variable-2">j</span> &lt; <span class="cm-variable-2">length</span>; <span class="cm-variable-2">j</span>++) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">v</span> = <span class="cm-variable-2">halfedges</span>[<span class="cm-variable-2">j</span>].<span class="cm-property">getEndpoint</span>();</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">points</span>.<span class="cm-property">push</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Point</span>(<span class="cm-variable">v</span>));</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">createPath</span>(<span class="cm-variable-2">points</span>, <span class="cm-variable">sites</span>[<span class="cm-variable-2">i</span>]);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre>}</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">removeSmallBits</span>(<span class="cm-def">path</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">averageLength</span> = <span class="cm-variable-2">path</span>.<span class="cm-property">length</span> / <span class="cm-variable-2">path</span>.<span class="cm-property">segments</span>.<span class="cm-property">length</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">min</span> = <span class="cm-variable-2">path</span>.<span class="cm-property">length</span> / <span class="cm-number">50</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">for</span>(<span class="cm-keyword">var</span> <span class="cm-def">i</span> = <span class="cm-variable-2">path</span>.<span class="cm-property">segments</span>.<span class="cm-property">length</span> - <span class="cm-number">1</span>; <span class="cm-variable-2">i</span> &gt;= <span class="cm-number">0</span>; <span class="cm-variable-2">i</span>--) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">segment</span> = <span class="cm-variable-2">path</span>.<span class="cm-property">segments</span>[<span class="cm-variable-2">i</span>];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">cur</span> = <span class="cm-variable-2">segment</span>.<span class="cm-property">point</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">nextSegment</span> = <span class="cm-variable-2">segment</span>.<span class="cm-property">next</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">next</span> = <span class="cm-variable-2">nextSegment</span>.<span class="cm-property">point</span> + <span class="cm-variable-2">nextSegment</span>.<span class="cm-property">handleIn</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span> (<span class="cm-variable-2">cur</span>.<span class="cm-property">getDistance</span>(<span class="cm-variable-2">next</span>) &lt; <span class="cm-variable-2">min</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">segment</span>.<span class="cm-property">remove</span>();</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre>}</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">generateBeeHivePoints</span>(<span class="cm-def">size</span>, <span class="cm-def">loose</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">points</span> = [];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">col</span> = <span class="cm-variable">view</span>.<span class="cm-property">size</span> / <span class="cm-variable-2">size</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">for</span>(<span class="cm-keyword">var</span> <span class="cm-def">i</span> = <span class="cm-number">-1</span>; <span class="cm-variable-2">i</span> &lt; <span class="cm-variable-2">size</span>.<span class="cm-property">width</span> + <span class="cm-number">1</span>; <span class="cm-variable-2">i</span>++) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span>(<span class="cm-keyword">var</span> <span class="cm-def">j</span> = <span class="cm-number">-1</span>; <span class="cm-variable-2">j</span> &lt; <span class="cm-variable-2">size</span>.<span class="cm-property">height</span> + <span class="cm-number">1</span>; <span class="cm-variable-2">j</span>++) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">point</span> = <span class="cm-keyword">new</span> <span class="cm-variable">Point</span>(<span class="cm-variable-2">i</span>, <span class="cm-variable-2">j</span>) / <span class="cm-keyword">new</span> <span class="cm-variable">Point</span>(<span class="cm-variable-2">size</span>) * <span class="cm-variable">view</span>.<span class="cm-property">size</span> + <span class="cm-variable-2">col</span> / <span class="cm-number">2</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-variable-2">j</span> % <span class="cm-number">2</span>)</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">point</span> += <span class="cm-keyword">new</span> <span class="cm-variable">Point</span>(<span class="cm-variable-2">col</span>.<span class="cm-property">width</span> / <span class="cm-number">2</span>, <span class="cm-number">0</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-variable-2">loose</span>)</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">point</span> += (<span class="cm-variable-2">col</span> / <span class="cm-number">4</span>) * <span class="cm-variable">Point</span>.<span class="cm-property">random</span>() - <span class="cm-variable-2">col</span> / <span class="cm-number">4</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">points</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">point</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">return</span> <span class="cm-variable-2">points</span>;</pre>
                    <pre>}</pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">createPath</span>(<span class="cm-def">points</span>, <span class="cm-def">center</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">path</span> = <span class="cm-keyword">new</span> <span class="cm-variable">Path</span>();</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">if</span> (!<span class="cm-variable">selected</span>) { </pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">path</span>.<span class="cm-property">fillColor</span> = <span class="cm-variable">spotColor</span>;</pre>
                    <pre><span class="cm-tab">    </span>} <span class="cm-keyword">else</span> {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">path</span>.<span class="cm-property">fullySelected</span> = <span class="cm-variable">selected</span>;</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable-2">path</span>.<span class="cm-property">closed</span> = <span class="cm-atom">true</span>;</pre>
                    <pre> </pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> = <span class="cm-number">0</span>, <span class="cm-def">l</span> = <span class="cm-variable-2">points</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span> &lt; <span class="cm-variable-2">l</span>; <span class="cm-variable-2">i</span>++) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">point</span> = <span class="cm-variable-2">points</span>[<span class="cm-variable-2">i</span>];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">next</span> = <span class="cm-variable-2">points</span>[(<span class="cm-variable-2">i</span> + <span class="cm-number">1</span>) == <span class="cm-variable-2">points</span>.<span class="cm-variable">length</span> ? <span class="cm-number">0</span> : <span class="cm-variable-2">i</span> + <span class="cm-number">1</span>];</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">vector</span> = (<span class="cm-variable-2">next</span> - <span class="cm-variable-2">point</span>) / <span class="cm-number">2</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-2">path</span>.<span class="cm-property">add</span>({</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-property">point</span>: <span class="cm-variable-2">point</span> + <span class="cm-variable-2">vector</span>,</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">handleIn</span>: -<span class="cm-variable-2">vector</span>,</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">handleOut</span>: <span class="cm-variable-2">vector</span></pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span>});</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable-2">path</span>.<span class="cm-property">scale</span>(<span class="cm-number">0.95</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">removeSmallBits</span>(<span class="cm-variable-2">path</span>);</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">return</span> <span class="cm-variable-2">path</span>;</pre>
                    <pre>}</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">onResize</span>() {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">var</span> <span class="cm-def">margin</span> = <span class="cm-number">20</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">bbox</span> = {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-property">xl</span>: <span class="cm-variable-2">margin</span>,</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-property">xr</span>: <span class="cm-variable">view</span>.<span class="cm-property">bounds</span>.<span class="cm-property">width</span> - <span class="cm-variable-2">margin</span>,</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">yt</span>: <span class="cm-variable-2">margin</span>,</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">yb</span>: <span class="cm-variable">view</span>.<span class="cm-variable">bounds</span>.<span class="cm-variable">height</span> - <span class="cm-variable-2">margin</span></pre>
                    <pre><span class="cm-tab">    </span>};</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> = <span class="cm-number">0</span>, <span class="cm-def">l</span> = <span class="cm-variable">sites</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span> &lt; <span class="cm-variable-2">l</span>; <span class="cm-variable-2">i</span>++) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">sites</span>[<span class="cm-variable-2">i</span>] = <span class="cm-variable">sites</span>[<span class="cm-variable-2">i</span>] * <span class="cm-variable">view</span>.<span class="cm-property">size</span> / <span class="cm-variable">oldSize</span>;</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">oldSize</span> = <span class="cm-variable">view</span>.<span class="cm-property">size</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-variable">renderDiagram</span>();</pre>
                    <pre>}</pre>
                    <pre> </pre>
                    <pre><span class="cm-keyword">function</span> <span class="cm-variable">onKeyDown</span>(<span class="cm-def">event</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-keyword">if</span> (<span class="cm-variable-2">event</span>.<span class="cm-property">key</span> == <span class="cm-string">'space'</span>) {</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">selected</span> = !<span class="cm-variable">selected</span>;</pre>
                    <pre><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">renderDiagram</span>();</pre>
                    <pre><span class="cm-tab">    </span>}</pre>
                    <pre>}</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/paperscript" canvas="canvas-1" data-paper-ignore="true">var voronoi =  new Voronoi();
var sites = generateBeeHivePoints(view.size / 200, true);
var bbox, diagram;
var oldSize = view.size;
var spotColor = new Color('red');
var mousePos = view.center;
var selected = false;

onResize();

function onMouseDown(event) {
	sites.push(event.point);
	renderDiagram();
}

function onMouseMove(event) {
	mousePos = event.point;
	if (event.count == 0)
		sites.push(event.point);
	sites[sites.length - 1] = event.point;
	renderDiagram();
}

function renderDiagram() {
	project.activeLayer.children = [];
	var diagram = voronoi.compute(sites, bbox);
	if (diagram) {
		for (var i = 0, l = sites.length; i < l; i++) {
			var cell = diagram.cells[sites[i].voronoiId];
			if (cell) {
				var halfedges = cell.halfedges,
					length = halfedges.length;
				if (length > 2) {
					var points = [];
					for (var j = 0; j < length; j++) {
						v = halfedges[j].getEndpoint();
						points.push(new Point(v));
					}
					createPath(points, sites[i]);
				}
			}
		}
	}
}

function removeSmallBits(path) {
	var averageLength = path.length / path.segments.length;
	var min = path.length / 50;
	for(var i = path.segments.length - 1; i >= 0; i--) {
		var segment = path.segments[i];
		var cur = segment.point;
		var nextSegment = segment.next;
		var next = nextSegment.point + nextSegment.handleIn;
		if (cur.getDistance(next) < min) {
			segment.remove();
		}
	}
}

function generateBeeHivePoints(size, loose) {
	var points = [];
	var col = view.size / size;
	for(var i = -1; i < size.width + 1; i++) {
		for(var j = -1; j < size.height + 1; j++) {
			var point = new Point(i, j) / new Point(size) * view.size + col / 2;
			if(j % 2)
				point += new Point(col.width / 2, 0);
			if(loose)
				point += (col / 4) * Point.random() - col / 4;
			points.push(point);
		}
	}
	return points;
}
function createPath(points, center) {
	var path = new Path();
	if (!selected) {
		path.fillColor = spotColor;
	} else {
		path.fullySelected = selected;
	}
	path.closed = true;

	for (var i = 0, l = points.length; i < l; i++) {
		var point = points[i];
		var next = points[(i + 1) == points.length ? 0 : i + 1];
		var vector = (next - point) / 2;
		path.add({
			point: point + vector,
			handleIn: -vector,
			handleOut: vector
		});
	}
	path.scale(0.95);
	removeSmallBits(path);
	return path;
}

function onResize() {
	var margin = 20;
	bbox = {
		xl: margin,
		xr: view.bounds.width - margin,
		yt: margin,
		yb: view.bounds.height - margin
	};
	for (var i = 0, l = sites.length; i < l; i++) {
		sites[i] = sites[i] * view.size / oldSize;
	}
	oldSize = view.size;
	renderDiagram();
}

function onKeyDown(event) {
	if (event.key == 'space') {
		selected = !selected;
		renderDiagram();
	}
}</script>
    <div class="canvas">
      <canvas resize="true" id="canvas-1" width="1002" height="1266" data-paper-scope="1" style="-webkit-user-drag: none; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);" class=""></canvas>
    </div>
  </div>
  <script src="functions.js"></script>
</body>

</html>
